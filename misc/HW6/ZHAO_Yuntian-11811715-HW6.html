<!DOCTYPE html>
<html>
<head>
<title>ZHAO_Yuntian-11811715-HW6.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="zhao-yuntian---11811715---homework-6">ZHAO Yuntian - 11811715 - Homework 6</h1>
<h2 id="proof-problems">Proof Problems</h2>
<h3 id="a">a)</h3>
<p>What above is previous dicussion.</p>
<hr>
<h1 id="%E5%85%B3%E4%BA%8Edelta-r--i%E7%9A%84%E8%AE%A8%E8%AE%BA">关于$\Delta R = I$的讨论</h1>
<h2 id="%E9%97%AE%E9%A2%98%E7%9A%84%E6%8F%90%E5%87%BA">问题的提出</h2>
<p>数值方法解机器人逆运动学问题的时候，当已知一组关节变量的值（记做$\tilde{q}$，是一个向量）时候，需要判断这一组关节变量在经过正运动学映射到末端执行器的位姿（记做$(\tilde{T}(\tilde{R},\tilde{p})=fk(\tilde{q}))$），是否与期望的位姿相(记做$T_{Ref}$)重合，如果不，则需要衡量二者之间的距离。</p>
<p>问题由此提出，当两个旋转变换矩阵$R_1,R_2$不想等的时候，是否可以表示同一种姿态？</p>
<h2 id="%E9%9C%80%E8%A6%81%E8%AF%81%E6%98%8E%E7%9A%84%E5%86%85%E5%AE%B9">需要证明的内容</h2>
<p>存在旋转变换矩阵$R_1,R_2$，满足$\Delta R = R_1 - R_2 = E$，且$R_1,R_2$表示同一种姿态。</p>
<h2 id="%E8%AF%81%E6%98%8E%E7%BB%93%E6%9E%9C">证明结果</h2>
<p>所有$R \in SO(3)$，都是旋转变换矩阵，即所有满足$R^TR=E$的$3 \times 3$的矩阵都是旋转变换矩阵。</p>
<p>则对于任意的$R \in SO(3)$，若满足$(R+E)^T(R+E)=R^TR+R^T+R+E=2E+R^T+R=E$，则必须满足$R^T+R+E=0$，但同时满足$R^TR=E$的矩阵$R$不存在（解方程过程略，存在自相矛盾），故这样的矩阵不存在。</p>
<h2 id="%E5%85%B6%E4%BB%96%E6%80%9D%E8%80%83">其他思考</h2>
<p>课上提出的误差计算公式是$err=||\Delta p||<em>2+||\Delta \theta||<em>2$，其中$(\Delta \theta, k) = ln \Delta R$，而考虑从当前$\tilde{R}$到$R</em>{Ref}$的姿态变换，应有$\Delta R = R</em>{ref}\tilde{R}^{-1}$，这里$\Delta R$是两个矩阵的“商”。那么需要证明的$\Delta R = OP(R_1,R_2)$是否也是“商”呢？如果是的话，则无需证明所有旋转矩阵都满足这一点；如果不是的话，是否这里$err$的计算存在某些问题？</p>
<h2 id="%E5%90%8E%E8%AE%B0">后记</h2>
<p>个人理解，可能有疏漏，希望老师指出或给予此问题更详细的解释；同时欢迎其他同学一起探讨。</p>
<hr>
<p>After the clarification of $R_0 \Delta R = R_{Ref}$, by what above, we will certainly have that <strong>if and ony if $R_0 = R_{Ref}$ we have the same orientation, so we must have $\Delta R = I$.</strong></p>
<h3 id="b">b)</h3>
<p>To pove $R^T_k(q) = R_k(-q)$ is to prove $R^T_k(-q) = R_k(q)$. We will use Rodrigues' formula to prove:<br>
$LHS=R^T_k(-q) = [e^{\hat{k} \cdot (-q)}]^T = [E + \hat{k}sin(-q) + (\hat{a})^2(1-cos(-q))]^T = E + \hat{(-k)}\cdot(-sin(q))+[(\hat{a})^2]^T(1-cos(q)) = E + \hat{k}sin(q)+(\hat{a})^2(1-cos(q)) = R_k(q)=RHS\ \square$</p>
<h2 id="code">Code</h2>
<p><em>Pseduo Code in a 'stack' form will be preformed to illustrate.</em></p>
<h3 id="setupbipedrobotm"><code>SetupBipedRobot.m</code></h3>
<h4 id="pseudo-code">pseudo code</h4>
<pre class="hljs"><code><div>Define Rad-Deg convertion and axis direction
Define uLINK, include name, mass, sister, child, vector b,a and angle q
	Call [MakeBox]
	% MakeBox generate 8 vertexes, each expressed ‘local’ frame and 6 faces, each expressed with 4 vertexes
	% input is dimension of x,y,z and coordinate of origin
	% output is vertexes and faces
	return
	Call [FindMother]
	% FindMother is recursively ‘assign’ mother to sister and child nodes
	% input the root of the tree
	% output nothing
	if input is NULL:return
	if input is ROOT:input-&gt;mother=NULL
	if input has child:
		input-&gt;child-&gt;mother=input
		call [FindMother],input=input-&gt;child
	if input has sister:
		input-&gt;sister-&gt;mother=input-&gt;mother
		call [FindMother],input=input-&gt;sister
	return
Label All LINK with number for convenience 
Set BODY LINK’s pose
	Call [ForwardKinematics]
	% ForwardKinematics is also a recursive function
	% input is the root of the tree
	% output is null, but update pose of all link via fk
	if input is NULL:return
	if input is not ROOT:
		relative position of this link = R * b + p
		Call [Rodrigues]
		% Rodrigues is like an inline function, input is axis and angle, output is rotation matrix
		Using Rodrigues formula to calculate
		return 
		relative oriantation of this link = R_mother * R_self calculated by Rodrigues
	call [FordwardKinematics],input=input-&gt;sister
	call [FordwardKinematics],input=input-&gt;child
Define linear and angular velocity of BODY in world frame
Set all joint velocity to zero
</div></code></pre>
<h4 id="scripts-involved">scripts involved</h4>
<pre class="hljs"><code><div>MakeBox
FindMother
ForwardKinematics
	Rodrigues
</div></code></pre>
<h3 id="iklegm"><code>IK_leg.m</code></h3>
<h4 id="pseudo-code">pseudo code</h4>
<pre class="hljs"><code><div>% this part is the MATLAB implementation of what is in Lecture Kinematics IV Page13-17
% IK_leg is a function whose input and output are:
% input uLINK part BODY, FOOT and distance of joints D, A and B
% output is the joint angle vector q
calculate vector r from p7 to p2 in world frame
calculate cos q5 using cosine rule with A,B and length of r
calculate q5 by in different cases of cos q5
calculate part of q6 denoted as alpha, using sine rule, with A,D,length of r and cos q5
calculate q7 with r transformed in FOOT's frame
calculate another part fo q6 with r transformed in FOOT's Frame
calculate q6 with its teo parts
calculate sphere HIP's three joint angles by matching up two matraces
</div></code></pre>
<p>$$R_z(q_2)R_x(q_3)R_y(q_4)=R_1^TR_7R_x(-q_7)R_y(-q_5-q_6)$$</p>
<pre class="hljs"><code><div>return vector q of q2 q3 q4 q5 q6 q7
</div></code></pre>
<h4 id="scripts-involved">scripts involved</h4>
<pre class="hljs"><code><div>none
</div></code></pre>
<h3 id="inversekinematicsm"><code>InverseKinematics.m</code></h3>
<h4 id="pseudo-code">pseudo code</h4>
<pre class="hljs"><code><div>% This is the implementation of the numerical method for inverse kinematics
% input is the target link and its pose
% output is numeric error
get links between target link and root by
	call [FindRoute]
	% FindRoute is recursive get the mother of a link and add it to a list, then return it
	% input is target link
	% output is a ordered list of link id from target to root
	if input is ROOT:
		return list{1}
	else:
		return list{input [FindRoute], input=input-&gt;mother}
	call [FordwardKinematics]
	% This has been detailed analysed in [SetupBipedRobot.m]
calculate error now
	Call [CalcVWerr]
	calculate position error just by misusing one another
	calculate theta error using Rotation matrix error
		call [rot2omega]
		% This is the logarithm of matrix
		return angular velocity vector
	return the error combining position error and angle error
% The program using for loop, but actually do-while loop is more suitable
for counter not reach maximum ierations:
	if error is less than thershold:
		break
	% use Newton method to minimum error, Jacobian is second order derivative 
		call [CalcJacobian]
		% This is the calculation of Jacobean matrix, but may be a different from the most simple way
		% The most simple ways is to do multi variable differential, and maybe another way told in RMC course
		% But this seems like using the so called screw theory. Each column of the Jacobean matrix is the screw axis of the robot. 
		return the Jacobean of now pose
	get revise dq = step_length * Jacobean / error
	% This numerical algorithm update the position of the end-of-effector in time
		call [MoveJoints]
		% This function transversely update the joints of all LINKs
		for all link in idx:
			update joint angle
		return
		call [ForwardKinematics]
		% This has been detailed discussed in [SetupBipedRobot.m]
		return the new end of effect pose
		call [CalcVWerr]
		% this has been detailed discussed in [InverseKinematics.m]
		return new error 
% Then is some output match (The nargout part)
</div></code></pre>
<h4 id="scripts-involved">scripts involved</h4>
<pre class="hljs"><code><div>FindRoute
ForwardKinematics
	Rodrigues
CalcVWerr
	rot2omega
	CalcJacobian
	MoveJoints
</div></code></pre>
<h3 id="fkrandomm"><code>fk_random.m</code></h3>
<h4 id="pseudo-code">pseudo code</h4>
<pre class="hljs"><code><div>% This script set up a biped robot and then random set joint angles, then perform forward kinematic and draw the resultant plot.
% The program loop forever to generate robot configure until user define signal SIGINT is sent.
Clear workspace
Define uLINK
Call [SetupBipedRobot.m] to create a robot
Set random seed
Create figure
While true:
	random left and right joint angles
	assign angles to robot
	set BODY pose
		call [ForwardKinematics],input is root
		% This function has been detailed discussed in [SetupBipedRobot.m]
		return
	clean figure
		call [DrawALLJoints]
		% This function recursively draw all LINK of the robot
		% input is root of the tree
		% output is nothing
		if input is not null:
			if input has word field vertex:
				convert its vertex to the world frame
					call [DrawPolygon]:
					% This function uses patch to draw polygon with input parameters
					% input is vertexes and faces, the same word field as in [SetupBipedRobot.m]
					draw polygon
			****		return
			if input-&gt;mother is not null:
					call [Connect3D]
					% This function just connect input points
					% input is mother link and child link
					% output is nothing
					return
				call [DrawCylinder]
				% This function just draw cylinder with input parameters
				% inputs are a reference point position, z axis direction , radius, length and color
				% no output
				draw cylinder with input parameters
				return 
				call [DrawAllJoints], input=input-&gt;sister
				call [DrawAllJoints], input=input-&gt;child
		return
	change view and axises of the plot, set z limits and open grid
	print abort message
	pause
</div></code></pre>
<h4 id="scripts-involved">scripts involved</h4>
<pre class="hljs"><code><div>SetupBipedRobot
	MakeBox
	FindMother
	ForwardKinematics
		Rodrigues
DrawAllJoints
	DrawPolygon
	Connect3D
	DrawCylinder
</div></code></pre>
<h3 id="ikrandomm"><code>ik_random.m</code></h3>
<h4 id="pseudo-cpde">pseudo cpde</h4>
<pre class="hljs"><code><div>% This script uses analytic inverse kinematics to caluclate a random given end-of-effector pose and re-draw it.
clear and set up robot
	call [SetupBipedRobot]
	return
set robot joints to non-singular angle
set random seed
open figure
% loop forever until SIGINT signal
while true:
	set BODY pose
	set left foot and right foot to random pose
		call [IK_leg]
		% IK_leg is analytic inverse kinematics of robot leg
		% It has been detialed discussed in [IK_Leg]
		return joint angles of left and right legs
	for all joints:
		set joint angle as what inverse kinematics calculated
		call [ForwardKinematics]
		% This has been detailed discussed in [SetupBipedRobot]
		return
	clean figure
		call [DrawAllJoints]
		% This has been detailed discussed in [fk_random.m]
		return
	change view, set axis and limits, open grid
	print abort message
	pause
</div></code></pre>
<h4 id="scripts-involved">scripts involved</h4>
<pre class="hljs"><code><div>SetupBipedRobot
	MakeBox
	FindMother
	ForwardKinematics
		Rodrigues
IK_Leg
DrawAllJoints
	DrawPolygon
	Connect3D
	DrawCylinder
</div></code></pre>
<h3 id="ikrandom2m"><code>ik_random2.m</code></h3>
<h4 id="pseudo-code">pseudo code</h4>
<pre class="hljs"><code><div>% This script uses numerical inverse kinematics to caluclate a random given end-of-effector pose and re-draw it.
clear and set up robot
	call [SetupBipedRobot]
	return
set robot joints to non-singular angle
set random seed
open figure
% loop forever until SIGINT signal
while true:
	set BODY pose
	set left foot and right foot to random pose
		call [InverseKinematics]
		% InverseKinematics is numerical inverse kinematics of robot end-of-effector
		% It has been detialed discussed in [InverseKinematics]
		return joint angles of left and right legs and errors
	for all joints:
		set joint angle as what inverse kinematics calculated
		call [ForwardKinematics]
		% This has been detailed discussed in [SetupBipedRobot]
		return
	clean figure
		call [DrawAllJoints]
		% This has been detailed discussed in [fk_random.m]
		return
	change view, set axis and limits, open grid
	print numerically inverse errors
	print abort message
	pause
</div></code></pre>
<h4 id="scripts-involved">scripts involved</h4>
<pre class="hljs"><code><div>SetupBipedRobot
	MakeBox
	FindMother
	ForwardKinematics
		Rodrigues
InverseKinematics
	FindRoute
	CalcVWerr
		rot2omega
		CalcJacobian
		MoveJoints
DrawAllJoints
	DrawPolygon
	Connect3D
	DrawCylinder
</div></code></pre>

</body>
</html>
